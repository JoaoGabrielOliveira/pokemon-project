#!/bin/bash
if [ "$1" != "" ]; then
  componentName=$1
  componentFileName="$(echo $1 | tr '[A-Z]' '[a-z]')"

  echo "Creating component $componentName (folder: $componentFileName)"

  mkdir $componentFileName
  cd $componentFileName
  echo '{
          "name": "react-component",
          "version": "0.0.0",
          "description": "React $componentName - Generated by react-init",
          "engines": {
            "node": ">= 5.2.0"
          },
          "license": "MIT"
        }' > package.json

  echo "Downloading template..."
  npm install --save-dev --ignore-scripts react-component-skeleton

  cp -rf ./node_modules/react-component-skeleton/* ./
  cd _template

  echo "Preparing component..."

  for file in */*.* ; do
    sed -i.bak "s/<%= component_name %>/$componentName/g" $file
    sed -i.bak "s/<%= component_file_name %>/$componentFileName/g" $file
  done

  for file in *.* ; do
    sed -i.bak "s/<%= component_name %>/$componentName/g" $file
    sed -i.bak "s/<%= component_file_name %>/$componentFileName/g" $file
  done

  for i in ./*/*.bak ; do
    rm $i
  done
  rm -rf *.bak

  mv ./src/component.js ./src/${componentFileName}.js
  mv ./test/component-test.js ./test/${componentFileName}-test.js

  cd ..

  rm -rf src
  rm -rf test

  cp -r _template/* ./
  rm -rf _template
  rm -rf node_modules
  rm -rf lib

  echo "All done!"
  echo "Type 'cd $componentFileName' and see the instructions on README.md"

else
  echo "Missing component name!

  Usage: react-init MyComponentName
  "
fi
